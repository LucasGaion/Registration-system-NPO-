<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    <script>
        // Configurações do provedor de autenticação OAuth 2.0
        const clientId = '8cf6d21d-6371-4da7-9eca-a4aac477492d';
        const tenantId = '3d43e001-1b92-4697-b855-1d8ca369b21e';
        const authorizationEndpoint = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize`;
        const tokenEndpoint = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/token`;
        const redirectUri = 'https://main.d1h8os4syq8ofp.amplifyapp.com/forms.html'; 
        const responseType = 'code';
        const scope = 'openid email profile';
        const clientSecret = 'YOUR_CLIENT_SECRET'; // substitua pelo seu segredo do cliente

        // Função para obter o token de acesso
        async function getAccessToken(code) {
            const response = await fetch(tokenEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    client_id: clientId,
                    scope: scope,
                    code: code,
                    redirect_uri: redirectUri,
                    grant_type: 'authorization_code',
                    client_secret: clientSecret
                })
            });
            const data = await response.json();
            return data.access_token;
        }

        // Função para obter o perfil do usuário
        async function getUserProfile(token) {
            const response = await fetch('https://graph.microsoft.com/v1.0/me', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const data = await response.json();
            console.log('User Profile:', data);
        }

        // Verifica se há um código de autorização na URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');

        if (code) {
            // Se houver um código, troca-o por um token de acesso e obtém o perfil do usuário
            getAccessToken(code).then(token => {
                getUserProfile(token);
            });
        } else {
            // Se não houver um código, redireciona para o provedor de autorização
            const authorizationUrl = `${authorizationEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}`;
            window.location.href = authorizationUrl;
        }
    </script>
</body>
</html>
